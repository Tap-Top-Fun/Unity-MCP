# Smithery configuration file: https://smithery.ai/docs/config#smitheryyaml
startCommand:
  type: stdio
  configSchema:
    type: object
    required:
      - UNITY_MCP_CLIENT_TRANSPORT
    properties:
      UNITY_MCP_CLIENT_TRANSPORT:
        type: string
        description: "http or stdio transport options"
        default: "stdio"
      UNITY_MCP_PORT:
        type: integer
        description: "The port for the Unity plugin"
        default: 8080
      UNITY_MCP_PLUGIN_TIMEOUT:
        type: integer
        description: "The timeout for the Unity plugin"
        default: 30000
  commandFunction:
    |-
    (config) => {
      const { execSync } = require('child_process');
      const imageName = 'ivanmurzakdev/unity-mcp-server';

      // Check if Docker image exists, pull if not
      try {
        execSync(`docker image inspect ${imageName}`, { stdio: 'ignore' });
      } catch (error) {
        console.log(`Docker image ${imageName} not found locally, pulling...`);
        execSync(`docker pull ${imageName}`, { stdio: 'inherit' });
      }

      return {
        command: 'docker',
        args: [
          'run',
          '-t',
          '-e', `UNITY_MCP_PORT=${config.UNITY_MCP_PORT}`,
          '-e', `UNITY_MCP_CLIENT_TRANSPORT=${config.UNITY_MCP_CLIENT_TRANSPORT}`,
          '-e', `UNITY_MCP_PLUGIN_TIMEOUT=${config.UNITY_MCP_PLUGIN_TIMEOUT}`,
          '-p', `8080:8080`,
          imageName
        ]
      };
    }
  exampleConfig:
    UNITY_MCP_CLIENT_TRANSPORT: "stdio"
    UNITY_MCP_PORT: 8080
    UNITY_MCP_PLUGIN_TIMEOUT: 30000